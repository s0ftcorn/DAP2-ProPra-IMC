#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <sys/wait.h>
#include <sys/types.h>

void error(char *str);

void benis(char *c_ptr);

int main(int argc, char **argv){
	char auswahl;
	while(1){
	printf("Main-PID: %d\n",getpid());
	printf("Bitte waehlen sie\nd fuer dolphin\np für ps\nx für xterm\n");
	scanf(" %c",&auswahl);
	if(auswahl == 'd') benis("dolphin");
	if(auswahl == 'p') benis("ps");
	if(auswahl == 'x') benis("xterm");
	}
	
	exit(EXIT_SUCCESS);
}

void benis(char *c_ptr){
	int pid = fork();
	printf("Die Gabel sagt: %d\n",pid);
	if(pid > 0){
		printf("Eltern-Prozess, PID des Kinds: %d\n",pid);
		int res;
		while((res=waitpid(-1,NULL,WNOHANG)) > 0){
			if(res == -1){
				if(errno != ECHILD){
					perror("waitpid");
					exit(EXIT_FAILURE);
				}
			}
		}
	}else if(pid == 0){
		printf("Im Kind-Prozess, PID %d, PPID %d\n",getpid(),getppid());
		int sid = setsid();
		if(sid < 0) return exit(EXIT_FAILURE);
		execlp(c_ptr,c_ptr,NULL);
	}else if(pid < 0){
		error("Die Gabel scheiterte!");
	}else{
		printf("Universe check failed.");
	}
}

void error(char *str){
	
	perror(str);
	exit(EXIT_FAILURE);
}